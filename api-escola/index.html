<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Gestão de Cursos</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <div>
            <h2>Alunos</h2>
            <button class="button" onclick="window.location.href='alunos.html'">Listar Alunos</button>
        </div>
        <h1>Gestão de Cursos</h1>

        <!-- Formulário de adicionar curso -->
        <section>
            <h2 class="subtitle">Adicionar Curso</h2>
            <form id="addForm">
                <div class="form-group">
                    <label for="nome">Nome:</label>
                    <input type="text" id="nome" required autofocus>
                </div>

                <div class="form-group">
                    <label for="descricao">Descrição:</label>
                    <textarea id="descricao" required></textarea>
                </div>

                <div class="form-group">
                    <label for="carga_horaria">Carga Horária:</label>
                    <input type="number" id="carga_horaria" required>
                </div>

                <button class="button" type="submit">Salvar</button>
            </form>
        </section>

        <!-- Lista de cursos -->
        <section>
            <h2>Lista de Cursos</h2>
            <div id="cursos" class="course-list"></div>
        </section>

        <script>
            const apiUrl = "http://localhost/moodle-integracao-api/api-escola/cursos.php";

            // Carregar cursos
            async function carregarCursos() {
                const res = await fetch(apiUrl);
                const data = await res.json();
                const container = document.getElementById("cursos");
                container.innerHTML = "";
                data.forEach(curso => {
                    const card = document.createElement("div");
                    card.className = "course-item";
                    card.innerHTML = `
          <h3>${curso.nome} (${curso.carga_horaria}h)</h3>
          <p>${curso.descricao}</p>
          <div class="actions">
            <button class="buttonEd" onclick="editarCurso(${curso.id})">Editar</button>
            <button class="buttonDel" onclick="excluirCurso(${curso.id})">Excluir</button>
          </div>
        `;
                    container.appendChild(card);
                });
            }

            // Adicionar curso
            document.getElementById("addForm").addEventListener("submit", async e => {
                e.preventDefault();
                const curso = {
                    nome: document.getElementById("nome").value,
                    descricao: document.getElementById("descricao").value,
                    carga_horaria: document.getElementById("carga_horaria").value
                };
                await fetch(apiUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(curso)
                });
                carregarCursos();
                e.target.reset();
            });

            // Editar curso (exemplo simples: prompt)
            async function editarCurso(id) {
                const nome = prompt("Novo nome:");
                const descricao = prompt("Nova descrição:");
                const carga = prompt("Nova carga horária:");
                if (!nome || !descricao || !carga) return;

                await fetch(apiUrl, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ id, nome, descricao, carga_horaria: carga })
                });
                carregarCursos();
            }

            // Excluir curso com confirmação
            async function excluirCurso(id) {
                if (confirm("Tem certeza que deseja excluir este curso?")) {
                    await fetch(apiUrl, {
                        method: "DELETE",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ id })
                    });
                    carregarCursos();
                }
            }

            // Inicializar
            carregarCursos();
        </script>
    </div>

    <div id="editModal" class="modal hidden">
        <div class="modal-content">
            <h2>Editar Curso</h2>
            <form id="editForm">
                <input type="hidden" id="editId">

                <div class="form-group">
                    <label for="editNome">Nome:</label>
                    <input type="text" id="editNome" required>
                </div>

                <div class="form-group">
                    <label for="editDesc">Descrição:</label>
                    <input type="text" id="editDesc" required>
                </div>

                <div class="form-group">
                    <label for="editCarga">Carga Horária:</label>
                    <input type="number" id="editCarga" required>
                </div>

                <button class="button" type="submit">Salvar Alterações</button>
                <button class="button" type="button" onclick="fecharModal()">Cancelar</button>
            </form>
        </div>
    </div>

</body>

</html>

<script>
    async function editarCurso(id) {
        const res = await fetch(apiUrl);
        const cursos = await res.json();
        const curso = cursos.find(a => a.id === id);

        document.getElementById("editId").value = curso.id;
        document.getElementById("editNome").value = curso.nome;
        document.getElementById("editDesc").value = curso.descricao;
        document.getElementById("editCarga").value = curso.carga_horaria;

        document.getElementById("editModal").classList.remove("hidden");
    }

    function fecharModal() {
        document.getElementById("editModal").classList.add("hidden");
    }

    document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
            fecharModal();
        }
    });

    document.getElementById("editForm").addEventListener("submit", async e => {
        e.preventDefault();

        const aluno = {
            id: document.getElementById("editId").value,
            nome: document.getElementById("editNome").value,
            descricao: document.getElementById("editDesc").value,
            carga_horaria: document.getElementById("editCarga").value
        };

        await fetch(apiUrl, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(aluno)
        });

        fecharModal();
        carregarCursos();
    });
</script>